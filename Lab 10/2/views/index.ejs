<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lab 10 - 2</title>
    <link rel="stylesheet" href="/css/index.css">
</head>
<body>
    <div class="todo-list">
        <div class="todo-head">
            <h1>My Todo List</h1>
            <a href="/create" class="add-todo">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-notebook-pen-icon lucide-notebook-pen">
                    <path d="M13.4 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-7.4" />
                    <path d="M2 6h4" />
                    <path d="M2 10h4" />
                    <path d="M2 14h4" />
                    <path d="M2 18h4" />
                    <path
                        d="M21.378 5.626a1 1 0 1 0-3.004-3.004l-5.01 5.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z" />
                </svg>
                <p>Add Todo</p>
            </a>
        </div>
        <div class="todo-table">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Deadline</th>
                        <th>Completed</th>
                    </tr>
                </thead>
                <tbody>
                    <% todos.forEach(todo => { %>
                        <tr>
                            <td><%= todo.id %></td>
                            <td><%= todo.title %></td>
                            <td><%= todo.deadline%></td>
                            <td>
                                <input type="checkbox"
                                    class="toggle-complete"
                                    data-id="<%= todo.id %>"
                                    <%= todo.status ? 'checked' : '' %>>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        </div>
    </div>
    <script>
        document.querySelectorAll('.toggle-complete').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
            const id = this.dataset.id;
            const completed = this.checked ? 1 : 0;

            fetch('/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ id, completed })
            })
            .then(res => res.json())
            .then(data => {
                console.log('Updated');
            })
            .catch(err => console.error(err));
            });
        });
    </script>
</body>

</html>